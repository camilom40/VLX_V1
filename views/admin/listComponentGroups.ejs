<!DOCTYPE html>
<html lang="en">
<head>
  <%- include('../partials/_head.ejs') %>
  <title>Accessories Component Groups Management</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@400;500;600;700&display=swap" rel="stylesheet">
  <style>
    body { font-family: 'DM Sans', sans-serif; background: linear-gradient(135deg, #f0f4f8 0%, #e2e8f0 100%); }
    
    .main-card {
      background: white;
      border-radius: 1rem;
      box-shadow: 0 4px 6px -1px rgba(0,0,0,0.1), 0 10px 15px -3px rgba(0,0,0,0.05);
      border: 1px solid rgba(226,232,240,0.8);
    }
    
    .stat-card {
      background: linear-gradient(135deg, #fff, #f8fafc);
      border-radius: 1rem;
      padding: 1.25rem;
      border: 1px solid #e2e8f0;
      transition: all 0.3s ease;
    }
    .stat-card:hover { transform: translateY(-2px); box-shadow: 0 8px 25px rgba(0,0,0,0.1); }
    
    .search-input {
      width: 100%;
      padding: 0.75rem 1rem 0.75rem 2.75rem;
      border-radius: 0.75rem;
      border: 2px solid #e2e8f0;
      background: #f8fafc;
      font-size: 0.9rem;
      transition: all 0.2s ease;
    }
    .search-input:hover { border-color: #cbd5e1; background: #fff; }
    .search-input:focus { outline: none; border-color: #3b82f6; background: #fff; box-shadow: 0 0 0 4px rgba(59,130,246,0.1); }
    
    .btn-primary {
      background: linear-gradient(135deg, #3b82f6, #2563eb);
      color: white; font-weight: 600; padding: 0.625rem 1.25rem;
      border-radius: 0.625rem; box-shadow: 0 4px 14px rgba(59,130,246,0.3);
      transition: all 0.3s ease; display: inline-flex; align-items: center; gap: 0.5rem;
    }
    .btn-primary:hover { background: linear-gradient(135deg, #2563eb, #1d4ed8); transform: translateY(-1px); }
    
    .btn-secondary {
      background: #f1f5f9; color: #475569; font-weight: 600;
      padding: 0.625rem 1.25rem; border-radius: 0.625rem;
      border: 2px solid #e2e8f0; transition: all 0.3s ease;
      display: inline-flex; align-items: center; gap: 0.5rem;
    }
    .btn-secondary:hover { background: #e2e8f0; border-color: #cbd5e1; }
    
    .table-container {
      overflow-x: auto;
      border-radius: 0.75rem;
    }
    
    .data-table {
      width: 100%;
      border-collapse: collapse;
    }
    .data-table thead {
      background: linear-gradient(135deg, #1e40af, #3b82f6);
    }
    .data-table th {
      padding: 1rem 1.25rem;
      text-align: left;
      font-size: 0.75rem;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.05em;
      color: white;
    }
    .data-table th:first-child { border-top-left-radius: 0.75rem; }
    .data-table th:last-child { border-top-right-radius: 0.75rem; }
    
    .data-table tbody tr {
      border-bottom: 1px solid #f1f5f9;
      transition: background 0.15s ease;
    }
    .data-table tbody tr:hover { background: #f8fafc; }
    .data-table tbody tr:last-child { border-bottom: none; }
    .data-table tbody tr:last-child td:first-child { border-bottom-left-radius: 0.75rem; }
    .data-table tbody tr:last-child td:last-child { border-bottom-right-radius: 0.75rem; }
    
    .data-table td {
      padding: 1rem 1.25rem;
      font-size: 0.875rem;
      color: #374151;
    }
    
    .badge {
      display: inline-flex;
      align-items: center;
      padding: 0.25rem 0.625rem;
      border-radius: 0.5rem;
      font-size: 0.75rem;
      font-weight: 600;
    }
    .badge-green { background: #d1fae5; color: #065f46; }
    .badge-red { background: #fee2e2; color: #991b1b; }
    .badge-indigo { background: #e0e7ff; color: #3730a3; }
    
    .action-btn {
      padding: 0.5rem;
      border-radius: 0.5rem;
      transition: all 0.2s ease;
    }
    .action-btn.edit { color: #3b82f6; }
    .action-btn.edit:hover { background: #eff6ff; color: #1d4ed8; }
    .action-btn.toggle { color: #f59e0b; }
    .action-btn.toggle:hover { background: #fef3c7; color: #d97706; }
    .action-btn.delete { color: #ef4444; }
    .action-btn.delete:hover { background: #fef2f2; color: #b91c1c; }
    
    .info-box {
      background: linear-gradient(135deg, #dbeafe, #e0f2fe);
      border: 1px solid #93c5fd;
      border-radius: 0.75rem;
      padding: 1rem;
    }
    
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }
    .animate-row { animation: fadeIn 0.3s ease-out forwards; }
  </style>
  <script>
    async function deleteComponentGroup(id, name) {
      if (confirm(`Are you sure you want to delete the component group "${name}"?\n\nThis action cannot be undone and may affect existing window systems that use this group.`)) {
        try {
          const response = await fetch(`/admin/component-groups/delete/${id}`, {
            method: 'DELETE',
            headers: {
              'Content-Type': 'application/json',
            },
          });
          const result = await response.json();
          alert(result.message);
          if (response.ok) {
            location.reload();
          }
        } catch (error) {
          console.error('Error deleting component group:', error);
          alert('Failed to delete component group');
        }
      }
    }

    document.addEventListener('DOMContentLoaded', () => {
      const searchInput = document.getElementById('searchInput');
      if (searchInput) {
        searchInput.addEventListener('keyup', function() {
          const filter = searchInput.value.toLowerCase();
          const rows = document.querySelectorAll('#componentGroupsTableBody tr');
          let visibleCount = 0;
          
          rows.forEach(row => {
            const cells = row.getElementsByTagName('td');
            let match = false;
            for (let i = 0; i < cells.length; i++) {
              if (cells[i].innerText.toLowerCase().includes(filter)) {
                match = true;
                break;
              }
            }
            if (match) {
              row.style.display = '';
              visibleCount++;
              row.classList.add('animate-row');
            } else {
              row.style.display = 'none';
            }
          });
          
          // Update search count
          const searchCount = document.getElementById('searchCount');
          if (searchCount) {
            const visibleCountSpan = document.getElementById('visibleCount');
            if (visibleCountSpan) {
              visibleCountSpan.textContent = visibleCount;
            }
            if (filter) {
              searchCount.classList.remove('hidden');
            } else {
              searchCount.classList.add('hidden');
            }
          }
        });
      }
    });
  </script>
</head>
<body class="min-h-screen flex flex-col">
  <%- include('../partials/_header.ejs') %>
  
  <main class="flex-grow container mx-auto px-4 py-8">
    <!-- Page Header -->
    <div class="flex items-center justify-between mb-6">
      <div class="flex items-center gap-4">
        <div class="w-12 h-12 rounded-xl bg-gradient-to-br from-purple-500 to-indigo-600 flex items-center justify-center shadow-lg">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10" />
          </svg>
        </div>
        <div>
          <h1 class="text-2xl font-bold text-gray-800">Accessories Component Groups</h1>
          <p class="text-gray-500 text-sm">Organize accessories into logical categories</p>
        </div>
      </div>
      <a href="/admin/component-groups/add" class="btn-primary">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6" />
        </svg>
        Add New Group
      </a>
    </div>

    <!-- Info Box -->
    <div class="info-box mb-6">
      <div class="flex items-start gap-3">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-blue-600 mt-0.5 flex-shrink-0" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
        </svg>
        <p class="text-blue-800 text-sm">
          Component groups are used to organize accessories into logical categories for user selection (e.g., handles, locks, hinges).
          These groups appear as dropdown options when configuring window systems.
        </p>
      </div>
    </div>

    <!-- Stats Cards -->
    <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
      <div class="stat-card">
        <div class="flex items-center gap-3">
          <div class="w-10 h-10 rounded-lg bg-purple-100 flex items-center justify-center">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-purple-600" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10" />
            </svg>
          </div>
          <div>
            <p class="text-2xl font-bold text-gray-800"><%= componentGroups.length %></p>
            <p class="text-xs text-gray-500">Total Groups</p>
          </div>
        </div>
      </div>
      <div class="stat-card">
        <div class="flex items-center gap-3">
          <div class="w-10 h-10 rounded-lg bg-green-100 flex items-center justify-center">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-green-600" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
            </svg>
          </div>
          <div>
            <p class="text-2xl font-bold text-gray-800"><%= componentGroups.filter(g => g.isActive).length %></p>
            <p class="text-xs text-gray-500">Active Groups</p>
          </div>
        </div>
      </div>
      <div class="stat-card">
        <div class="flex items-center gap-3">
          <div class="w-10 h-10 rounded-lg bg-amber-100 flex items-center justify-center">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-amber-600" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" />
            </svg>
          </div>
          <div>
            <p class="text-2xl font-bold text-gray-800"><%= componentGroups.filter(g => !g.isActive).length %></p>
            <p class="text-xs text-gray-500">Inactive Groups</p>
          </div>
        </div>
      </div>
    </div>

    <!-- Search and Actions Bar -->
    <div class="main-card p-4 mb-6">
      <div class="flex flex-col md:flex-row md:items-center justify-between gap-4">
        <!-- Search -->
        <div class="relative flex-1 max-w-md">
          <div class="absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
            </svg>
          </div>
          <input type="text" id="searchInput" class="search-input pl-10" placeholder="Search by name, description...">
          <span id="searchCount" class="absolute right-3 top-1/2 transform -translate-y-1/2 text-xs text-gray-400 hidden">
            <span id="visibleCount"><%= componentGroups.length %></span> results
          </span>
        </div>
        
        <!-- Right Actions -->
        <div class="flex items-center gap-3">
          <a href="/admin" class="btn-secondary">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18" />
            </svg>
            Back to Admin
          </a>
        </div>
      </div>
    </div>

    <!-- Table -->
    <% if (componentGroups.length > 0) { %>
      <div class="main-card">
        <div class="table-container">
          <table class="data-table">
            <thead>
              <tr>
                <th>Display Name</th>
                <th>Internal Name</th>
                <th>Description</th>
                <th>Sort Order</th>
                <th>Status</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody id="componentGroupsTableBody">
              <% componentGroups.forEach(function(group) { %>
                <tr>
                  <td>
                    <div class="font-semibold text-gray-900"><%= group.displayName %></div>
                  </td>
                  <td>
                    <code class="badge badge-indigo"><%= group.name %></code>
                  </td>
                  <td>
                    <div class="text-gray-600 max-w-xs">
                      <%= group.description || '<span class="text-gray-400 italic">No description</span>' %>
                    </div>
                  </td>
                  <td>
                    <div class="text-gray-600 font-medium"><%= group.sortOrder %></div>
                  </td>
                  <td>
                    <% if (group.isActive) { %>
                      <span class="badge badge-green">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-3 w-3 mr-1" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
                        </svg>
                        Active
                      </span>
                    <% } else { %>
                      <span class="badge badge-red">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-3 w-3 mr-1" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                        </svg>
                        Inactive
                      </span>
                    <% } %>
                  </td>
                  <td>
                    <div class="flex items-center gap-2">
                      <a href="/admin/component-groups/edit/<%= group._id %>" 
                         class="action-btn edit" title="Edit">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z" />
                        </svg>
                      </a>
                      
                      <form action="/admin/component-groups/toggle/<%= group._id %>" method="POST" class="inline">
                        <button type="submit" 
                                class="action-btn toggle" 
                                title="<%= group.isActive ? 'Deactivate' : 'Activate' %>">
                          <% if (group.isActive) { %>
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 9v6m4-6v6m7-3a9 9 0 11-18 0 9 9 0 0118 0z" />
                            </svg>
                          <% } else { %>
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14.752 11.168l-3.197-2.132A1 1 0 0010 9.87v4.263a1 1 0 001.555.832l3.197-2.132a1 1 0 000-1.664z" />
                              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                            </svg>
                          <% } %>
                        </button>
                      </form>
                      
                      <button type="button" 
                              class="action-btn delete" 
                              onclick="deleteComponentGroup('<%= group._id %>', '<%= group.displayName %>')"
                              title="Delete">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" />
                        </svg>
                      </button>
                    </div>
                  </td>
                </tr>
              <% }); %>
            </tbody>
          </table>
        </div>
      </div>
    <% } else { %>
      <div class="main-card p-12 text-center">
        <div class="w-16 h-16 mx-auto mb-4 rounded-full bg-purple-100 flex items-center justify-center">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8 text-purple-600" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10" />
          </svg>
        </div>
        <h3 class="text-xl font-bold text-gray-900 mb-2">No Component Groups Yet</h3>
        <p class="text-gray-600 mb-6">Get started by creating your first component group to organize accessories.</p>
        <a href="/admin/component-groups/add" class="btn-primary inline-flex">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6" />
          </svg>
          Create First Component Group
        </a>
      </div>
    <% } %>
  </main>
  
  <%- include('../partials/_footer.ejs') %>
</body>
</html>
